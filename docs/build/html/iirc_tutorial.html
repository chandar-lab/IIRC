
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IIRC Package Tutorial Using PyTorch &#8212; IIRC 0.1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Lifelong Learning Methods Guide" href="lll_methods_guide.html" />
    <link rel="prev" title="Welcome to IIRC’s documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="section" id="IIRC-Package-Tutorial-Using-PyTorch">
<h1>IIRC Package Tutorial Using PyTorch<a class="headerlink" href="#IIRC-Package-Tutorial-Using-PyTorch" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="kn">from</span> <span class="nn">iirc.lll_dataset.torch_lll_dataset</span> <span class="kn">import</span> <span class="n">TorchLLLDataset</span>
<span class="kn">from</span> <span class="nn">iirc.iirc_definitions</span> <span class="kn">import</span> <span class="n">IIRC_SETUP</span><span class="p">,</span> <span class="n">CIL_SETUP</span><span class="p">,</span> <span class="n">NO_LABEL_PLACEHOLDER</span>
</pre></div>
</div>
</div>
<div class="section" id="Using-CIL-setup-(Class-Incremental-Learning)">
<h2>Using CIL setup (Class Incremental Learning)<a class="headerlink" href="#Using-CIL-setup-(Class-Incremental-Learning)" title="Permalink to this headline">¶</a></h2>
<p>Let’s create a mock dataset of 120 samples, with each belonging to one of the four classes <strong>A</strong> - <strong>B</strong> - <strong>C</strong> - <strong>D</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">n_per_y</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_per_y</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_per_y</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_per_y</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_per_y</span>
</pre></div>
</div>
</div>
<p>Now this dataset should be converted to the format used by the lll_datasets, where images should be a pillow images (or strings representing the images path in case of large datasets, such as ImageNet), and the dataset should be arranged as a list of tuples of the form (image, (label,))</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span>
<span class="n">mock_dataset</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;RGB&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<p>Now let’s create a tasks schedule, where the first task introduces the labels <strong>A</strong> and <strong>B</strong>, and the second task introduces <strong>C</strong> and <strong>D</strong> (tasks don’t need to be of equal size)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<p>We also need a transformations function that takes the image and converts it to a tensor, as well as normalize the image, apply augmentations, etc.</p>
<p>There are two such functions that can be provided: <em>essential_transforms_fn</em> and <em>augmentation_transforms_fn</em></p>
<p>If <em>augmentation_transforms_fn</em> is provided, it will always be applied except if the <em>TorchLLLDataset</em> is told not to apply augmentations in a specific context (we will see later how)</p>
<p>Otherwise, <em>essential_transforms_fn</em> will be applied</p>
<p>So for example in a test set where augmentations are not needed, <em>augmentation_transforms_fn</em> shouldn’t be provided in the <em>TorchLLLDataset</em> initialization</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">torchvision.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>

<span class="n">essential_transforms_fn</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
<span class="n">augmentation_transforms_fn</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">RandomCrop</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">RandomHorizontalFlip</span><span class="p">(),</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<p>Now we are ready to initialize the incremental dataset</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span> <span class="o">=</span> <span class="n">TorchLLLDataset</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">mock_dataset</span><span class="p">,</span> <span class="n">tasks</span><span class="o">=</span><span class="n">tasks</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">CIL_SETUP</span><span class="p">,</span>
                              <span class="n">essential_transforms_fn</span><span class="o">=</span><span class="n">essential_transforms_fn</span><span class="p">,</span>
                              <span class="n">augmentation_transforms_fn</span><span class="o">=</span><span class="n">augmentation_transforms_fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then we can make use of <em>cil_dataset</em> by choosing the task we wish to train on using the <em>choose_task(task_id)</em> function, and creating a dataloader out of it</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If we print the length of the dataset, we will only get the length of the samples that belong to the current task. The same goes for fetching a sample, as we only have access to the samples of the current task. This means that indexing the <em>cil_dataset</em> is relative to the current task, so the 0th sample for example will be different when we choose another task</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cil_dataset</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
60
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(tensor([[[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          ...,
          [0.0000, 0.0000, 0.0000,  ..., 0.5137, 0.7647, 0.7412],
          [0.0000, 0.0000, 0.0000,  ..., 0.1725, 0.4000, 0.9922],
          [0.0000, 0.0000, 0.0000,  ..., 0.2549, 0.7137, 0.3373]],

         [[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          ...,
          [0.0000, 0.0000, 0.0000,  ..., 0.7804, 0.6314, 0.9529],
          [0.0000, 0.0000, 0.0000,  ..., 0.8471, 0.8471, 0.8196],
          [0.0000, 0.0000, 0.0000,  ..., 0.1098, 0.6000, 0.4235]],

         [[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          ...,
          [0.0000, 0.0000, 0.0000,  ..., 0.2157, 0.0941, 0.6118],
          [0.0000, 0.0000, 0.0000,  ..., 0.4000, 0.0706, 0.3529],
          [0.0000, 0.0000, 0.0000,  ..., 0.8549, 0.1765, 0.3451]]]),
 &#39;A&#39;,
 &#39;None&#39;)
</pre></div></div>
</div>
<p>As we have seen the format returned when we fetch a sample from the dataset is a tuple of length 3 consisting of (image tensor, image label, NO_LABEL_PLACEHOLDER), NO_LABEL_PLACEHOLDER is set to the string “None” and should be ignored in the class incremental setup.</p>
<p>We can also access what classes have we seen thus far (they don’t reset if a previous task is re-chosen, also they are unordered):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">cil_dataset</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">cur_task_id</span><span class="si">}</span><span class="s2">, current task: </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">cur_task</span><span class="si">}</span><span class="s2">, dataset length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cil_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">, classes seen: </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">seen_classes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">cil_dataset</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">cur_task_id</span><span class="si">}</span><span class="s2">, current task: </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">cur_task</span><span class="si">}</span><span class="s2">, dataset length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cil_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">, classes seen: </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">seen_classes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Task 0, current task: [&#39;A&#39;, &#39;B&#39;], dataset length: 60, classes seen: [&#39;B&#39;, &#39;A&#39;]
Task 1, current task: [&#39;C&#39;, &#39;D&#39;], dataset length: 60, classes seen: [&#39;D&#39;, &#39;B&#39;, &#39;C&#39;, &#39;A&#39;]
</pre></div></div>
</div>
<p>If we need to load the data of all the tasks up to a specific task (including it), this can be done using the <em>load_tasks_up_to(task_id)</em> function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">load_tasks_up_to</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;current task: </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">cur_task</span><span class="si">}</span><span class="s2">, dataset length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cil_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
current task: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;], dataset length: 120
</pre></div></div>
</div>
<p>If a sample needs to be accessed in it’s original form (PIL form) without any transformations, for example to be added to the replay buffer, the <em>get_item(index)</em> method can be used:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;PIL.Image.Image image mode=RGB size=32x32 at 0x286B762A460&gt;, &#39;A&#39;, &#39;None&#39;)
</pre></div></div>
</div>
<p>and if we need to know the indices of the samples that belong to a specific class, this can be done using the <em>get_image_indices_by_cla(class name)</em> method, however, this can only be done if that class belongs to the current task. Moreover, these indices are relative to the current task, so whenever we change the task, they would point to totally different samples in the new task</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">get_image_indices_by_cla</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([17,  7, 29, 26, 13,  2,  6, 15, 27, 21, 19, 10,  5,  9,  4, 14,  3,
       22, 20,  0, 23, 28, 18, 11, 12,  8, 16, 24, 25,  1])
</pre></div></div>
</div>
<p>If <em>cil_dataset</em> uses data augmentations, but we needed to disable them in a specific part of the code, this context manager can be used:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">cil_dataset</span><span class="o">.</span><span class="n">disable_augmentations</span><span class="p">():</span>
    <span class="c1"># any samples loaded here will have the essential transformations function applied to them</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<p>Finally, to load this dataset in minibatches for training, the torch dataloader can be used with it, <strong>but don’t forget to reinstantiate the dataloader whenever the task changes</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="n">cil_dataset</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">cil_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[tensor([[[[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           ...,
           [0.0000, 0.0000, 0.0000,  ..., 0.6235, 0.8745, 0.3255],
           [0.0000, 0.0000, 0.0000,  ..., 0.2118, 0.9804, 0.7490],
           [0.0000, 0.0000, 0.0000,  ..., 0.0902, 0.4235, 0.9373]],

          [[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           ...,
           [0.0000, 0.0000, 0.0000,  ..., 0.1882, 0.4745, 0.4510],
           [0.0000, 0.0000, 0.0000,  ..., 0.4353, 0.6039, 0.6863],
           [0.0000, 0.0000, 0.0000,  ..., 0.2118, 0.5373, 0.1333]],

          [[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           ...,
           [0.0000, 0.0000, 0.0000,  ..., 0.8471, 0.8196, 0.3373],
           [0.0000, 0.0000, 0.0000,  ..., 0.1765, 0.8118, 0.7686],
           [0.0000, 0.0000, 0.0000,  ..., 0.0118, 0.8510, 0.6980]]],


         [[[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           ...,
           [0.0000, 0.4745, 0.9294,  ..., 0.0549, 0.8471, 0.0000],
           [0.0000, 0.2118, 0.1882,  ..., 0.8863, 0.1765, 0.5647],
           [0.0000, 0.6667, 0.4118,  ..., 0.5176, 0.7922, 0.4275]],

          [[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           ...,
           [0.0000, 0.8314, 0.0353,  ..., 0.6000, 0.7176, 0.6549],
           [0.0000, 0.8314, 0.2196,  ..., 0.2157, 0.9333, 0.6275],
           [0.0000, 0.8549, 0.6667,  ..., 0.0431, 0.4039, 0.9451]],

          [[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           ...,
           [0.0000, 0.2941, 0.6039,  ..., 0.4863, 0.2471, 0.7765],
           [0.0000, 0.9725, 0.9137,  ..., 0.3804, 0.1451, 0.2275],
           [0.0000, 0.6745, 0.1216,  ..., 0.1412, 0.8078, 0.8353]]]]),
 (&#39;B&#39;, &#39;A&#39;),
 (&#39;None&#39;, &#39;None&#39;)]
</pre></div></div>
</div>
</div>
<div class="section" id="Using-IIRC-setup-(Incremental-Implicitly-Refined-Classification)">
<h2>Using IIRC setup (Incremental Implicitly Refined Classification)<a class="headerlink" href="#Using-IIRC-setup-(Incremental-Implicitly-Refined-Classification)" title="Permalink to this headline">¶</a></h2>
<p>Now Imaging that samples belonging to class <strong>A</strong> have also another sublabel of either <strong>Aa</strong> or <strong>Ab</strong>, and the samples belonging to class <strong>B</strong> have another sublabel of either <strong>Ba</strong> or <strong>Bb</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_iirc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y_iirc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Aa&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">:</span>
        <span class="n">y_iirc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Ab&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y_iirc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;Ba&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span>
        <span class="n">y_iirc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;Bb&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_iirc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="p">,))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_iirc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,)]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mock_dataset_iirc</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;RGB&#39;</span><span class="p">),</span> <span class="n">y_iirc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mock_dataset_iirc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;PIL.Image.Image image mode=RGB size=32x32 at 0x286B76358E0&gt;, (&#39;A&#39;, &#39;Aa&#39;))
</pre></div></div>
</div>
<p>let’s redefine the tasks by incorporating the new subclasses</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tasks_iirc</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Aa&quot;</span><span class="p">,</span> <span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Ab&quot;</span><span class="p">,</span> <span class="s2">&quot;Bb&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<p>All the functionality that we mentioned in the CIL setup is still applicable here, but there are some differences though.</p>
<p>The first difference is that in the training set, we don’t necessarily need all the samples that belong to both labels <strong>A</strong> and <strong>Aa</strong> to be seen across the two tasks, what makes more sense is that some of them need to appear in the first task and some others need to appear in the second task, probably with some overlap</p>
<p>Hence we have the two arguments <em>superclass_data_pct</em> and <em>subclass_data_pct</em>: * <em>superclass_data_pct</em> controls the percentage of the samples that belong to <strong>A</strong> that will appear when <strong>A</strong> is introduced * <em>subclass_data_pct</em> controls the percentage of the samples that belong to <strong>Aa</strong> that will appear when <strong>Aa</strong> is introduced (same for other subclasses)</p>
<p>So in this example we have 15 samples that have the labels (<strong>A</strong>, <strong>Aa</strong>), and 15 samples that have the labels (<strong>A</strong>, <strong>Ab</strong>): * <em>superclass_data_pct</em> = 1.0, <em>subclass_data_pct</em> = 1.0: This means that all 30 samples with label <strong>A</strong> will appear in the first task, then all 15 samples with label <strong>Aa</strong> will appear in the second task, etc (100% overlab) * <em>superclass_data_pct</em> = 0.5, <em>subclass_data_pct</em> = 0.5: 15 samples with label <strong>A</strong> will appear in the first task, then 8 samples with label
<strong>Aa</strong> will appear in the second task, etc (no overlab) * <em>superclass_data_pct</em> = 0.6, <em>subclass_data_pct</em> = 0.8: 18 samples with label <strong>A</strong> will appear in the first task, then 12 samples with label <strong>Aa</strong> will appear in the second task, etc (40% overlab)</p>
<p>This procedure will only be done if the argument <em>test_mode</em> is set to <em>False</em>, as in the test set we don’t care about this kind of data repetition but we care more about evaluating on all the available samples</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">iirc_dataset_train</span> <span class="o">=</span> <span class="n">TorchLLLDataset</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">mock_dataset_iirc</span><span class="p">,</span> <span class="n">tasks</span><span class="o">=</span><span class="n">tasks_iirc</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">IIRC_SETUP</span><span class="p">,</span> <span class="n">test_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">essential_transforms_fn</span><span class="o">=</span><span class="n">essential_transforms_fn</span><span class="p">,</span>
                                     <span class="n">augmentation_transforms_fn</span><span class="o">=</span><span class="n">augmentation_transforms_fn</span><span class="p">,</span>
                                     <span class="n">superclass_data_pct</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">subclass_data_pct</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="n">iirc_dataset_test</span> <span class="o">=</span> <span class="n">TorchLLLDataset</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">mock_dataset_iirc</span><span class="p">,</span> <span class="n">tasks</span><span class="o">=</span><span class="n">tasks_iirc</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">IIRC_SETUP</span><span class="p">,</span> <span class="n">test_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                     <span class="n">essential_transforms_fn</span><span class="o">=</span><span class="n">essential_transforms_fn</span><span class="p">,</span>
                                     <span class="n">augmentation_transforms_fn</span><span class="o">=</span><span class="n">augmentation_transforms_fn</span><span class="p">)</span>

<span class="n">iirc_dataset_train</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">iirc_dataset_test</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of task 0 training data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">iirc_dataset_train</span><span class="p">)</span><span class="si">}</span><span class="s2">, number of samples for class A: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">iirc_dataset_train</span><span class="o">.</span><span class="n">get_image_indices_by_cla</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of task 0 training data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">iirc_dataset_train</span><span class="p">)</span><span class="si">}</span><span class="s2">, number of samples for class A: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">iirc_dataset_test</span><span class="o">.</span><span class="n">get_image_indices_by_cla</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of task 0 training data: 66, number of samples for class A: 18
Length of task 0 training data: 66, number of samples for class A: 30
</pre></div></div>
</div>
<p>The second difference is the concept of incomplete information, so typically in the IIRC setup, the model is not told all the labels of a sample, but only the labels that correspond to the current task, and the model should figure the other labels on its own.</p>
<p>This only applies to the training set though, as for the test set you need to know all the labels to evaluate the model properly</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">labels_</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Aa&quot;</span><span class="p">,</span> <span class="s2">&quot;Ab&quot;</span><span class="p">]</span>
<span class="n">iirc_dataset_train</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">iirc_dataset_test</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_</span><span class="p">):</span>
    <span class="n">iirc_dataset_train</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
    <span class="n">iirc_dataset_test</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
    <span class="n">train_sample</span><span class="p">,</span> <span class="n">train_label1</span><span class="p">,</span> <span class="n">train_label2</span> <span class="o">=</span> \
        <span class="n">iirc_dataset_train</span><span class="p">[</span><span class="n">iirc_dataset_train</span><span class="o">.</span><span class="n">get_image_indices_by_cla</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">test_sample</span><span class="p">,</span> <span class="n">test_label1</span><span class="p">,</span> <span class="n">test_label2</span> <span class="o">=</span> \
        <span class="n">iirc_dataset_test</span><span class="p">[</span><span class="n">iirc_dataset_test</span><span class="o">.</span><span class="n">get_image_indices_by_cla</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">training sample label: </span><span class="si">{</span><span class="p">(</span><span class="n">train_label1</span><span class="p">,</span> <span class="n">train_label2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test sample label: </span><span class="si">{</span><span class="n">test_label1</span><span class="p">,</span> <span class="n">test_label2</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
task 0:
training sample label: (&#39;A&#39;, &#39;None&#39;)
test sample label: (&#39;A&#39;, &#39;None&#39;)

task 1:
training sample label: (&#39;Aa&#39;, &#39;None&#39;)
test sample label: (&#39;Aa&#39;, &#39;A&#39;)

task 2:
training sample label: (&#39;Ab&#39;, &#39;None&#39;)
test sample label: (&#39;A&#39;, &#39;Ab&#39;)

</pre></div></div>
</div>
<p>To make a dataset use the <em>complete information</em> mode irrespective of whether it is a training set or a test set, the argument <em>complete_information_mode</em> can be provided when initializing the dataset, and the functions <em>enable_complete_information_mode()</em> and <em>enable_incomplete_information_mode()</em> can be used as well after initialization.</p>
<p>Take note that the <em>load_tasks_up_to(task_id)</em> function doesn’t work in the <em>incomplete information</em></p>
</div>
<div class="section" id="Usage-with-Incremental-CIFAR100,-IIRC-CIFAR100,-Incremental-Imagenet,-IIRC-Imagenet">
<h2>Usage with Incremental-CIFAR100, IIRC-CIFAR100, Incremental-Imagenet, IIRC-Imagenet<a class="headerlink" href="#Usage-with-Incremental-CIFAR100,-IIRC-CIFAR100,-Incremental-Imagenet,-IIRC-Imagenet" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">iirc.lll_datasets_loader</span> <span class="kn">import</span> <span class="n">get_lll_datasets</span>
<span class="kn">from</span> <span class="nn">iirc.iirc_definitions</span> <span class="kn">import</span> <span class="n">PYTORCH</span>
<span class="kn">from</span> <span class="nn">iirc.utils.download_cifar</span> <span class="kn">import</span> <span class="n">download_extract_cifar100</span>
</pre></div>
</div>
</div>
<p>For using these datasets with the preset tasks schedules, the original <em>CIFAR100</em> and/or <em>ImageNet2012</em> need to be downloaded first.</p>
<p>In the case of <em>CIFAR100</em>, the dataset can be downloaded using the following method</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">download_extract_cifar100</span><span class="p">(</span><span class="s2">&quot;./data&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
extracting CIFAR 100
dataset extracted
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
E:\Work\Master_Research\ContinualRefinement\ContinualRefinement\iirc\utils\download_cifar.py:15: UserWarning: ./data\cifar-100-python.tar.gz already exists, the dataset won&#39;t be download
  warnings.warn(f&#34;{target_path} already exists, the dataset won&#39;t be download&#34;)
</pre></div></div>
</div>
<p>In the case of <em>ImageNet</em>, it has to be downloaded manually, and be arranged in the following manner: * Imagenet * train * n01440764 * n01443537 * … * val * n01440764 * n01443537 * …</p>
<p>Then the <em>get_lll_datasets</em> function should be used. The tasks schedules/configurations preset per dataset are:</p>
<ul class="simple">
<li><p><em>Incremental-CIFAR100</em>: 10 configurations, each starting with 50 classes in the first task, followed by 10 tasks each having 5 classes</p></li>
<li><p><em>IIRC-CIFAR100</em>: 10 configurations, each starting with 10 superclasses in the first task, followed by 21 tasks each having 5 classes</p></li>
<li><p><em>Incremental-Imagenet-full</em>: 5 configurations, each starting with 160 classes in the first task, followed by 28 tasks each having 30 classes</p></li>
<li><p><em>Incremental-Imagenet-lite</em>: 5 configurations, each starting with 160 classes in the first task, followed by 9 tasks each having 30 classes</p></li>
<li><p><em>IIRC-Imagenet-full</em>: 5 configurations, each starting with 63 superclasses in the first task, followed by 34 tasks each having 30 classes</p></li>
<li><p><em>IIRC-Imagenet-lite</em>: 5 configurations, each starting with 63 superclasses in the first task, followed by 9 tasks each having 30 classes</p></li>
</ul>
<p>Although these configurations might seem they are limiting the choices, but the point here is to have a standard set of tasks and class orders so that the results are comparable across different works, otherwise if needed, new task configurations can be added manually as well in the <em>metadata</em> folder</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[30]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># The datasets supported are (&quot;incremental_cifar100&quot;, &quot;iirc_cifar100&quot;, &quot;incremental_imagenet_full&quot;, &quot;incremental_imagenet_lite&quot;,</span>
<span class="c1"># &quot;iirc_imagenet_full&quot;, &quot;iirc_imagenet_lite&quot;)</span>
<span class="n">lll_datasets</span><span class="p">,</span> <span class="n">tasks</span><span class="p">,</span> <span class="n">class_names_to_idx</span> <span class="o">=</span> <span class="n">get_lll_datasets</span><span class="p">(</span><span class="n">dataset_name</span> <span class="o">=</span> <span class="s2">&quot;iirc_cifar100&quot;</span><span class="p">,</span>
                                                           <span class="n">dataset_root</span> <span class="o">=</span> <span class="s2">&quot;./data&quot;</span><span class="p">,</span> <span class="c1"># the parent directory of cifar-100-python or the imagenet folders</span>
                                                           <span class="n">setup</span> <span class="o">=</span> <span class="n">IIRC_SETUP</span><span class="p">,</span>
                                                           <span class="n">framework</span> <span class="o">=</span> <span class="n">PYTORCH</span><span class="p">,</span>
                                                           <span class="n">tasks_configuration_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                                           <span class="n">essential_transforms_fn</span> <span class="o">=</span> <span class="n">essential_transforms_fn</span><span class="p">,</span>
                                                           <span class="n">augmentation_transforms_fn</span> <span class="o">=</span> <span class="n">augmentation_transforms_fn</span><span class="p">,</span>
                                                           <span class="n">joint</span> <span class="o">=</span> <span class="kc">False</span>
                                                          <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Creating iirc_cifar100
Setup used: IIRC
Using PyTorch
Dataset created
</pre></div></div>
</div>
<p><em>joint</em> can also be set to <em>True</em> in case of joint training (all classes will come in one task)</p>
<p>The result of the previous function has the following form:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lll_datasets</span> <span class="c1"># four splits</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[31]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;train&#39;: &lt;iirc.lll_dataset.torch_lll_dataset.TorchLLLDataset at 0x286ba877070&gt;,
 &#39;intask_valid&#39;: &lt;iirc.lll_dataset.torch_lll_dataset.TorchLLLDataset at 0x286b8835fd0&gt;,
 &#39;posttask_valid&#39;: &lt;iirc.lll_dataset.torch_lll_dataset.TorchLLLDataset at 0x286b8835f70&gt;,
 &#39;test&#39;: &lt;iirc.lll_dataset.torch_lll_dataset.TorchLLLDataset at 0x286b8835dc0&gt;}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[35]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">tasks</span><span class="p">[:</span><span class="mi">3</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[[&#39;flowers&#39;, &#39;small_mammals&#39;, &#39;trees&#39;, &#39;aquatic_mammals&#39;, &#39;fruit_and_vegetables&#39;, &#39;people&#39;, &#39;food_containers&#39;, &#39;vehicles&#39;, &#39;large_carnivores&#39;, &#39;insects&#39;], [&#39;television&#39;, &#39;spider&#39;, &#39;shrew&#39;, &#39;mountain&#39;, &#39;hamster&#39;], [&#39;road&#39;, &#39;poppy&#39;, &#39;household_furniture&#39;, &#39;woman&#39;, &#39;bee&#39;]]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">class_names_to_idx</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;flowers&#39;: 0, &#39;small_mammals&#39;: 1, &#39;trees&#39;: 2, &#39;aquatic_mammals&#39;: 3, &#39;fruit_and_vegetables&#39;: 4, &#39;people&#39;: 5, &#39;food_containers&#39;: 6, &#39;vehicles&#39;: 7, &#39;large_carnivores&#39;: 8, &#39;insects&#39;: 9, &#39;television&#39;: 10, &#39;spider&#39;: 11, &#39;shrew&#39;: 12, &#39;mountain&#39;: 13, &#39;hamster&#39;: 14, &#39;road&#39;: 15, &#39;poppy&#39;: 16, &#39;household_furniture&#39;: 17, &#39;woman&#39;: 18, &#39;bee&#39;: 19, &#39;tulip&#39;: 20, &#39;clock&#39;: 21, &#39;orange&#39;: 22, &#39;beaver&#39;: 23, &#39;rocket&#39;: 24, &#39;bicycle&#39;: 25, &#39;can&#39;: 26, &#39;squirrel&#39;: 27, &#39;wardrobe&#39;: 28, &#39;bus&#39;: 29, &#39;whale&#39;: 30, &#39;sweet_pepper&#39;: 31, &#39;telephone&#39;: 32, &#39;leopard&#39;: 33, &#39;bowl&#39;: 34, &#39;skyscraper&#39;: 35, &#39;baby&#39;: 36, &#39;cockroach&#39;: 37, &#39;boy&#39;: 38, &#39;lobster&#39;: 39, &#39;motorcycle&#39;: 40, &#39;forest&#39;: 41, &#39;tank&#39;: 42, &#39;orchid&#39;: 43, &#39;chair&#39;: 44, &#39;crab&#39;: 45, &#39;girl&#39;: 46, &#39;keyboard&#39;: 47, &#39;otter&#39;: 48, &#39;bed&#39;: 49, &#39;butterfly&#39;: 50, &#39;lawn_mower&#39;: 51, &#39;snail&#39;: 52, &#39;caterpillar&#39;: 53, &#39;wolf&#39;: 54, &#39;pear&#39;: 55, &#39;tiger&#39;: 56, &#39;pickup_truck&#39;: 57, &#39;cup&#39;: 58, &#39;reptiles&#39;: 59, &#39;train&#39;: 60, &#39;sunflower&#39;: 61, &#39;beetle&#39;: 62, &#39;apple&#39;: 63, &#39;palm_tree&#39;: 64, &#39;plain&#39;: 65, &#39;large_omnivores_and_herbivores&#39;: 66, &#39;rose&#39;: 67, &#39;tractor&#39;: 68, &#39;crocodile&#39;: 69, &#39;mushroom&#39;: 70, &#39;couch&#39;: 71, &#39;lamp&#39;: 72, &#39;mouse&#39;: 73, &#39;bridge&#39;: 74, &#39;turtle&#39;: 75, &#39;willow_tree&#39;: 76, &#39;man&#39;: 77, &#39;lizard&#39;: 78, &#39;maple_tree&#39;: 79, &#39;lion&#39;: 80, &#39;elephant&#39;: 81, &#39;seal&#39;: 82, &#39;sea&#39;: 83, &#39;dinosaur&#39;: 84, &#39;worm&#39;: 85, &#39;bear&#39;: 86, &#39;castle&#39;: 87, &#39;plate&#39;: 88, &#39;dolphin&#39;: 89, &#39;medium_sized_mammals&#39;: 90, &#39;streetcar&#39;: 91, &#39;bottle&#39;: 92, &#39;kangaroo&#39;: 93, &#39;snake&#39;: 94, &#39;house&#39;: 95, &#39;chimpanzee&#39;: 96, &#39;raccoon&#39;: 97, &#39;porcupine&#39;: 98, &#39;oak_tree&#39;: 99, &#39;pine_tree&#39;: 100, &#39;possum&#39;: 101, &#39;skunk&#39;: 102, &#39;fish&#39;: 103, &#39;fox&#39;: 104, &#39;cattle&#39;: 105, &#39;ray&#39;: 106, &#39;aquarium_fish&#39;: 107, &#39;cloud&#39;: 108, &#39;flatfish&#39;: 109, &#39;rabbit&#39;: 110, &#39;trout&#39;: 111, &#39;camel&#39;: 112, &#39;table&#39;: 113, &#39;shark&#39;: 114}
</pre></div></div>
</div>
<p><em>lll_datasets</em> has four splits, where <em>train</em> is for training, <em>intask_valid</em> is for validation during task training (in case of IIRC setup, this split is using <em>incomplete information</em> like the <em>train</em> split), <em>posttask_valid</em> is for validation after each task training (in case of IIRC setup, this split is using <em>complete information</em> like the <em>test</em> split), and finally the <em>test</em> split</p>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">IIRC</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">IIRC Package Tutorial Using PyTorch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Using-CIL-setup-(Class-Incremental-Learning)">Using CIL setup (Class Incremental Learning)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Using-IIRC-setup-(Incremental-Implicitly-Refined-Classification)">Using IIRC setup (Incremental Implicitly Refined Classification)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Usage-with-Incremental-CIFAR100,-IIRC-CIFAR100,-Incremental-Imagenet,-IIRC-Imagenet">Usage with Incremental-CIFAR100, IIRC-CIFAR100, Incremental-Imagenet, IIRC-Imagenet</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="lll_methods_guide.html">Lifelong Learning Methods Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="iirc.html">iirc package</a></li>
<li class="toctree-l1"><a class="reference internal" href="lll_methods.html">lll_methods package</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to IIRC’s documentation!</a></li>
      <li>Next: <a href="lll_methods_guide.html" title="next chapter">Lifelong Learning Methods Guide</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Mohamed Abdelsalam, Mojtaba Faramarzi, Shagun Sodhani, Sarath Chandar (Chandar-Lab/Mila).
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.4.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/iirc_tutorial.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>