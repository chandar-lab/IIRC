

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>IIRC Package Tutorial Using PyTorch &mdash; IIRC 0.1.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Loading IIRC and incremental datasets" href="loading_datasets_tutorial.html" />
    <link rel="prev" title="Welcome to IIRC’s documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> IIRC
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">IIRC Package Tutorial Using PyTorch</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Using-CIL-setup-(Class-Incremental-Learning)">Using CIL setup (Class Incremental Learning)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Using-IIRC-setup-(Incremental-Implicitly-Refined-Classification)">Using IIRC setup (Incremental Implicitly Refined Classification)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="loading_datasets_tutorial.html">Loading IIRC and incremental datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="lifelong_methods_guide.html">Lifelong Learning Methods Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="iirc.html">iirc package</a></li>
<li class="toctree-l1"><a class="reference internal" href="lifelong_methods.html">lifelong_methods package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">IIRC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>IIRC Package Tutorial Using PyTorch</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/iirc_tutorial.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="IIRC-Package-Tutorial-Using-PyTorch">
<h1>IIRC Package Tutorial Using PyTorch<a class="headerlink" href="#IIRC-Package-Tutorial-Using-PyTorch" title="Permalink to this headline">¶</a></h1>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="kn">from</span> <span class="nn">iirc.lifelong_dataset.torch_dataset</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">from</span> <span class="nn">iirc.definitions</span> <span class="kn">import</span> <span class="n">IIRC_SETUP</span><span class="p">,</span> <span class="n">CIL_SETUP</span><span class="p">,</span> <span class="n">NO_LABEL_PLACEHOLDER</span>
</pre></div>
</div>
</div>
<div class="section" id="Using-CIL-setup-(Class-Incremental-Learning)">
<h2>Using CIL setup (Class Incremental Learning)<a class="headerlink" href="#Using-CIL-setup-(Class-Incremental-Learning)" title="Permalink to this headline">¶</a></h2>
<p>Let’s create a mock dataset of 120 samples, with each belonging to one of the four classes <strong>A</strong> - <strong>B</strong> - <strong>C</strong> - <strong>D</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">n_per_y</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_per_y</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;B&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_per_y</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_per_y</span> <span class="o">+</span> <span class="p">[</span><span class="s2">&quot;D&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_per_y</span>
</pre></div>
</div>
</div>
<p>Now this dataset should be converted to the format used by the lifelong_datasets, where images should be a pillow images (or strings representing the images path in case of large datasets, such as ImageNet), and the dataset should be arranged as a list of tuples of the form (image, (label,))</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="mi">255</span><span class="p">)</span>
<span class="n">mock_dataset</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;RGB&#39;</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<p>Now let’s create a tasks schedule, where the first task introduces the labels <strong>A</strong> and <strong>B</strong>, and the second task introduces <strong>C</strong> and <strong>D</strong> (tasks don’t need to be of equal size)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tasks</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<p>We also need a transformations function that takes the image and converts it to a tensor, as well as normalize the image, apply augmentations, etc.</p>
<p>There are two such functions that can be provided: <em>essential_transforms_fn</em> and <em>augmentation_transforms_fn</em></p>
<p>If <em>augmentation_transforms_fn</em> is provided, it will always be applied except if the <em>Dataset</em> is told not to apply augmentations in a specific context (we will see later how)</p>
<p>Otherwise, <em>essential_transforms_fn</em> will be applied</p>
<p>So for example in a test set where augmentations are not needed, <em>augmentation_transforms_fn</em> shouldn’t be provided in the <em>Dataset</em> initialization</p>
<p>Hence, <em>essential_transforms_fn</em> should include any essential transformations that should be applied to the PIL image (such as convert to tensor), while <em>augmentation_transforms_fn</em> should also include the essential transformations, in addition to any augmentations that need to be applied (such as random horizontal flipping, etc)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">torchvision.transforms</span> <span class="k">as</span> <span class="nn">transforms</span>

<span class="n">essential_transforms_fn</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
<span class="n">augmentation_transforms_fn</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">RandomCrop</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">RandomHorizontalFlip</span><span class="p">(),</span>
    <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">()</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<p>Now we are ready to initialize the incremental dataset</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">mock_dataset</span><span class="p">,</span> <span class="n">tasks</span><span class="o">=</span><span class="n">tasks</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">CIL_SETUP</span><span class="p">,</span>
                              <span class="n">essential_transforms_fn</span><span class="o">=</span><span class="n">essential_transforms_fn</span><span class="p">,</span>
                              <span class="n">augmentation_transforms_fn</span><span class="o">=</span><span class="n">augmentation_transforms_fn</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Then we can make use of <em>cil_dataset</em> by choosing the task we wish to train on using the <em>choose_task(task_id)</em> function, and creating a dataloader out of it</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If we print the length of the dataset, we will only get the length of the samples that belong to the current task. The same goes for fetching a sample, as we only have access to the samples of the current task. This means that indexing the <em>cil_dataset</em> is relative to the current task, so the 0th sample for example will be different when we choose another task</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cil_dataset</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
60
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(tensor([[[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          [0.8431, 0.6902, 0.9294,  ..., 0.0000, 0.0000, 0.0000],
          [0.5922, 0.0510, 0.6314,  ..., 0.0000, 0.0000, 0.0000],
          ...,
          [0.3804, 0.2863, 0.5451,  ..., 0.0000, 0.0000, 0.0000],
          [0.2235, 0.8431, 0.8118,  ..., 0.0000, 0.0000, 0.0000],
          [0.8275, 0.8667, 0.6471,  ..., 0.0000, 0.0000, 0.0000]],

         [[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          [0.9294, 0.3882, 0.2745,  ..., 0.0000, 0.0000, 0.0000],
          [0.4392, 0.7098, 0.7922,  ..., 0.0000, 0.0000, 0.0000],
          ...,
          [0.7176, 0.5725, 0.0118,  ..., 0.0000, 0.0000, 0.0000],
          [0.9137, 0.6471, 0.9882,  ..., 0.0000, 0.0000, 0.0000],
          [0.3804, 0.4667, 0.3216,  ..., 0.0000, 0.0000, 0.0000]],

         [[0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
          [0.2353, 0.2824, 0.5882,  ..., 0.0000, 0.0000, 0.0000],
          [0.5765, 0.5490, 0.5686,  ..., 0.0000, 0.0000, 0.0000],
          ...,
          [0.5020, 0.0941, 0.0745,  ..., 0.0000, 0.0000, 0.0000],
          [0.3412, 0.8392, 0.2745,  ..., 0.0000, 0.0000, 0.0000],
          [0.9922, 0.0627, 0.2314,  ..., 0.0000, 0.0000, 0.0000]]]),
 &#39;A&#39;,
 &#39;None&#39;)
</pre></div></div>
</div>
<p>As we have seen the format returned when we fetch a sample from the dataset is a tuple of length 3 consisting of (image tensor, image label, NO_LABEL_PLACEHOLDER), NO_LABEL_PLACEHOLDER is set to the string “None” and should be ignored in the class incremental setup.</p>
<p>We can also access what classes have we seen thus far (they don’t reset if a previous task is re-chosen, also they are unordered):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">cil_dataset</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">cur_task_id</span><span class="si">}</span><span class="s2">, current task: </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">cur_task</span><span class="si">}</span><span class="s2">, dataset length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cil_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">, classes seen: </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">seen_classes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">cil_dataset</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Task </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">cur_task_id</span><span class="si">}</span><span class="s2">, current task: </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">cur_task</span><span class="si">}</span><span class="s2">, dataset length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cil_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">, classes seen: </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">seen_classes</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Task 0, current task: [&#39;A&#39;, &#39;B&#39;], dataset length: 60, classes seen: [&#39;A&#39;, &#39;B&#39;]
Task 1, current task: [&#39;C&#39;, &#39;D&#39;], dataset length: 60, classes seen: [&#39;C&#39;, &#39;A&#39;, &#39;B&#39;, &#39;D&#39;]
</pre></div></div>
</div>
<p>If we need to load the data of all the tasks up to a specific task (including it), this can be done using the <em>load_tasks_up_to(task_id)</em> function</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">load_tasks_up_to</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;current task: </span><span class="si">{</span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">cur_task</span><span class="si">}</span><span class="s2">, dataset length: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">cil_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
current task: [&#39;A&#39;, &#39;B&#39;, &#39;C&#39;, &#39;D&#39;], dataset length: 120
</pre></div></div>
</div>
<p>If a sample needs to be accessed in it’s original form (PIL form) without any transformations, for example to be added to the replay buffer, the <em>get_item(index)</em> method can be used:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">get_item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;PIL.Image.Image image mode=RGB size=32x32 at 0x22D7FF5FF10&gt;, &#39;A&#39;, &#39;None&#39;)
</pre></div></div>
</div>
<p>and if we need to know the indices of the samples that belong to a specific class, this can be done using the <em>get_image_indices_by_cla(class name)</em> method, however, this can only be done if that class belongs to the current task. Moreover, these indices are relative to the current task, so whenever we change the task, they would point to totally different samples in the new task</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">cil_dataset</span><span class="o">.</span><span class="n">get_image_indices_by_cla</span><span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([29,  3, 23, 17, 10, 28,  2, 12, 22,  5, 19,  1, 25,  8,  4, 27,  7,
       16, 11, 21, 24, 15, 18,  9, 13, 26, 20, 14,  6,  0])
</pre></div></div>
</div>
<p>If <em>cil_dataset</em> uses data augmentations, but we needed to disable them in a specific part of the code, this context manager can be used:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="k">with</span> <span class="n">cil_dataset</span><span class="o">.</span><span class="n">disable_augmentations</span><span class="p">():</span>
    <span class="c1"># any samples loaded here will have the essential transformations function applied to them</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<p>Finally, to load this dataset in minibatches for training, the torch dataloader can be used with it, <strong>but don’t forget to reinstantiate the dataloader whenever the task changes</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span>
<span class="n">cil_dataset</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">cil_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">train_loader</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[tensor([[[[0.0000, 0.0000, 0.0000,  ..., 0.9059, 0.3020, 0.3294],
           [0.0000, 0.0000, 0.0000,  ..., 0.6588, 0.7255, 0.1373],
           [0.0000, 0.0000, 0.0000,  ..., 0.5725, 0.1137, 0.7373],
           ...,
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000]],

          [[0.0000, 0.0000, 0.0000,  ..., 0.4510, 0.6980, 0.2000],
           [0.0000, 0.0000, 0.0000,  ..., 0.6941, 0.6784, 0.2353],
           [0.0000, 0.0000, 0.0000,  ..., 0.8392, 0.0980, 0.1843],
           ...,
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000]],

          [[0.0000, 0.0000, 0.0000,  ..., 0.9216, 0.9725, 0.4549],
           [0.0000, 0.0000, 0.0000,  ..., 0.1529, 0.8157, 0.2745],
           [0.0000, 0.0000, 0.0000,  ..., 0.8941, 0.1765, 0.1412],
           ...,
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000]]],


         [[[0.0000, 0.0000, 0.0000,  ..., 0.3843, 0.1843, 0.8078],
           [0.0000, 0.0000, 0.0000,  ..., 0.0588, 0.1961, 0.5882],
           [0.0000, 0.0000, 0.0000,  ..., 0.5843, 0.0275, 0.1725],
           ...,
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000]],

          [[0.0000, 0.0000, 0.0000,  ..., 0.5961, 0.4549, 0.3137],
           [0.0000, 0.0000, 0.0000,  ..., 0.7059, 0.2902, 0.2706],
           [0.0000, 0.0000, 0.0000,  ..., 0.5412, 0.3412, 0.7098],
           ...,
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000]],

          [[0.0000, 0.0000, 0.0000,  ..., 0.5098, 0.0902, 0.6667],
           [0.0000, 0.0000, 0.0000,  ..., 0.1216, 0.2706, 0.7922],
           [0.0000, 0.0000, 0.0000,  ..., 0.5294, 0.1098, 0.5294],
           ...,
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000],
           [0.0000, 0.0000, 0.0000,  ..., 0.0000, 0.0000, 0.0000]]]]),
 (&#39;B&#39;, &#39;A&#39;),
 (&#39;None&#39;, &#39;None&#39;)]
</pre></div></div>
</div>
</div>
<div class="section" id="Using-IIRC-setup-(Incremental-Implicitly-Refined-Classification)">
<h2>Using IIRC setup (Incremental Implicitly Refined Classification)<a class="headerlink" href="#Using-IIRC-setup-(Incremental-Implicitly-Refined-Classification)" title="Permalink to this headline">¶</a></h2>
<p>Now Imaging that samples belonging to class <strong>A</strong> have also another sublabel of either <strong>Aa</strong> or <strong>Ab</strong>, and the samples belonging to class <strong>B</strong> have another sublabel of either <strong>Ba</strong> or <strong>Bb</strong></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">y_iirc</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y_iirc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Aa&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">:</span>
        <span class="n">y_iirc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Ab&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">y_iirc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;Ba&quot;</span><span class="p">))</span>
    <span class="k">elif</span> <span class="n">label</span> <span class="o">==</span> <span class="s2">&quot;B&quot;</span><span class="p">:</span>
        <span class="n">y_iirc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;Bb&quot;</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_iirc</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">label</span><span class="p">,))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_iirc</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;A&#39;, &#39;Aa&#39;), (&#39;A&#39;, &#39;Ab&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;B&#39;, &#39;Ba&#39;), (&#39;B&#39;, &#39;Bb&#39;), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;C&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,), (&#39;D&#39;,)]
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mock_dataset_iirc</span> <span class="o">=</span> <span class="p">[(</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;RGB&#39;</span><span class="p">),</span> <span class="n">y_iirc</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">mock_dataset_iirc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(&lt;PIL.Image.Image image mode=RGB size=32x32 at 0x22D7FF79B80&gt;, (&#39;A&#39;, &#39;Aa&#39;))
</pre></div></div>
</div>
<p>let’s redefine the tasks by incorporating the new subclasses</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">tasks_iirc</span> <span class="o">=</span> <span class="p">[[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="s2">&quot;C&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Aa&quot;</span><span class="p">,</span> <span class="s2">&quot;Ba&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;Ab&quot;</span><span class="p">,</span> <span class="s2">&quot;Bb&quot;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<p>All the functionality that we mentioned in the CIL setup is still applicable here, but there are some differences though.</p>
<p>The first difference is that in the training set, we don’t necessarily need all the samples that belong to both labels <strong>A</strong> and <strong>Aa</strong> to be seen across the two tasks, what makes more sense is that some of them need to appear in the first task and some others need to appear in the second task, probably with some overlap</p>
<p>Hence we have the two arguments <em>superclass_data_pct</em> and <em>subclass_data_pct</em>: * <em>superclass_data_pct</em> controls the percentage of the samples that belong to <strong>A</strong> that will appear when <strong>A</strong> is introduced * <em>subclass_data_pct</em> controls the percentage of the samples that belong to <strong>Aa</strong> that will appear when <strong>Aa</strong> is introduced (same for other subclasses)</p>
<p>So in this example we have 15 samples that have the labels (<strong>A</strong>, <strong>Aa</strong>), and 15 samples that have the labels (<strong>A</strong>, <strong>Ab</strong>): * <em>superclass_data_pct</em> = 1.0, <em>subclass_data_pct</em> = 1.0: This means that all 30 samples with label <strong>A</strong> will appear in the first task, then all 15 samples with label <strong>Aa</strong> will appear in the second task, etc (100% overlab) * <em>superclass_data_pct</em> = 0.5, <em>subclass_data_pct</em> = 0.5: 15 samples with label <strong>A</strong> will appear in the first task, then 8 samples with label
<strong>Aa</strong> will appear in the second task, etc (no overlab) * <em>superclass_data_pct</em> = 0.6, <em>subclass_data_pct</em> = 0.8: 18 samples with label <strong>A</strong> will appear in the first task, then 12 samples with label <strong>Aa</strong> will appear in the second task, etc (40% overlab)</p>
<p>This procedure will only be done if the argument <em>test_mode</em> is set to <em>False</em>, as in the test set we don’t care about this kind of data repetition but we care more about evaluating on all the available samples</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">iirc_dataset_train</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">mock_dataset_iirc</span><span class="p">,</span> <span class="n">tasks</span><span class="o">=</span><span class="n">tasks_iirc</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">IIRC_SETUP</span><span class="p">,</span> <span class="n">test_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">essential_transforms_fn</span><span class="o">=</span><span class="n">essential_transforms_fn</span><span class="p">,</span>
                                     <span class="n">augmentation_transforms_fn</span><span class="o">=</span><span class="n">augmentation_transforms_fn</span><span class="p">,</span>
                                     <span class="n">superclass_data_pct</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">subclass_data_pct</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

<span class="n">iirc_dataset_test</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">dataset</span><span class="o">=</span><span class="n">mock_dataset_iirc</span><span class="p">,</span> <span class="n">tasks</span><span class="o">=</span><span class="n">tasks_iirc</span><span class="p">,</span> <span class="n">setup</span><span class="o">=</span><span class="n">IIRC_SETUP</span><span class="p">,</span> <span class="n">test_mode</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                     <span class="n">essential_transforms_fn</span><span class="o">=</span><span class="n">essential_transforms_fn</span><span class="p">,</span>
                                     <span class="n">augmentation_transforms_fn</span><span class="o">=</span><span class="n">augmentation_transforms_fn</span><span class="p">)</span>

<span class="n">iirc_dataset_train</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">iirc_dataset_test</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of task 0 training data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">iirc_dataset_train</span><span class="p">)</span><span class="si">}</span><span class="s2">, number of samples for class A: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">iirc_dataset_train</span><span class="o">.</span><span class="n">get_image_indices_by_cla</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Length of task 0 training data: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">iirc_dataset_train</span><span class="p">)</span><span class="si">}</span><span class="s2">, number of samples for class A: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">iirc_dataset_test</span><span class="o">.</span><span class="n">get_image_indices_by_cla</span><span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Length of task 0 training data: 66, number of samples for class A: 18
Length of task 0 training data: 66, number of samples for class A: 30
</pre></div></div>
</div>
<p>The second difference is the concept of incomplete information, so typically in the IIRC setup, the model is not told all the labels of a sample, but only the labels that correspond to the current task, and the model should figure the other labels on its own.</p>
<p>This only applies to the training set though, as for the test set you need to know all the labels to evaluate the model properly</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">labels_</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;Aa&quot;</span><span class="p">,</span> <span class="s2">&quot;Ab&quot;</span><span class="p">]</span>
<span class="n">iirc_dataset_train</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="n">iirc_dataset_test</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">task_id</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels_</span><span class="p">):</span>
    <span class="n">iirc_dataset_train</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
    <span class="n">iirc_dataset_test</span><span class="o">.</span><span class="n">choose_task</span><span class="p">(</span><span class="n">task_id</span><span class="p">)</span>
    <span class="n">train_sample</span><span class="p">,</span> <span class="n">train_label1</span><span class="p">,</span> <span class="n">train_label2</span> <span class="o">=</span> \
        <span class="n">iirc_dataset_train</span><span class="p">[</span><span class="n">iirc_dataset_train</span><span class="o">.</span><span class="n">get_image_indices_by_cla</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">test_sample</span><span class="p">,</span> <span class="n">test_label1</span><span class="p">,</span> <span class="n">test_label2</span> <span class="o">=</span> \
        <span class="n">iirc_dataset_test</span><span class="p">[</span><span class="n">iirc_dataset_test</span><span class="o">.</span><span class="n">get_image_indices_by_cla</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">num_samples</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;task </span><span class="si">{</span><span class="n">task_id</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="s2">training sample label: </span><span class="si">{</span><span class="p">(</span><span class="n">train_label1</span><span class="p">,</span> <span class="n">train_label2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;test sample label: </span><span class="si">{</span><span class="n">test_label1</span><span class="p">,</span> <span class="n">test_label2</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
task 0:
training sample label: (&#39;A&#39;, &#39;None&#39;)
test sample label: (&#39;A&#39;, &#39;None&#39;)

task 1:
training sample label: (&#39;Aa&#39;, &#39;None&#39;)
test sample label: (&#39;A&#39;, &#39;Aa&#39;)

task 2:
training sample label: (&#39;Ab&#39;, &#39;None&#39;)
test sample label: (&#39;A&#39;, &#39;Ab&#39;)

</pre></div></div>
</div>
<p>To make a dataset use the <em>complete information</em> mode irrespective of whether it is a training set or a test set, the argument <em>complete_information_mode</em> can be provided when initializing the dataset, and the functions <em>enable_complete_information_mode()</em> and <em>enable_incomplete_information_mode()</em> can be used as well after initialization.</p>
<p>Take note that the <em>load_tasks_up_to(task_id)</em> function doesn’t work in the <em>incomplete information</em></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="loading_datasets_tutorial.html" class="btn btn-neutral float-right" title="Loading IIRC and incremental datasets" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to IIRC’s documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, Mohamed Abdelsalam, Mojtaba Faramarzi, Shagun Sodhani, Sarath Chandar (Chandar-Lab/Mila).

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>